/*
 * CartonBox 1.3.2 by Const Lab, constlab.ru/portfolio/cartonbox/
 */
!function(o){o.cartonbox=function(a){function t(a){if(b.onStartBefore(a),o(".cartonbox-body").data("cb-existing-hash")||(s=window.location.hash,s=s.replace("#",""),o(".cartonbox-body").data("cb-existing-hash",s)),!o(".cartonbox-body").data("cb-top")){var t=o(window).scrollTop();o(".cartonbox-body").data("cb-top",t).css({position:"fixed",top:-t,left:0,right:0,bottom:0,overflow:"hidden"}).addClass("cartonbox-on")}if(o(".cartonbox-back").fadeIn(b.speed),a.data("cb-group")&&""!=a.data("cb-group")&&"dotted"==b.nav){var r=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"]").not(".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav a").length;if(r>1){for(var c="",e=0;r>e;e++){var i=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"][data-cb-group-index="+e+"]"),d=i.attr("href"),x=i.data("cb-type"),l=i.data("cb-caption"),p=i.data("cb-hash"),h=i.data("cb-design");c=c+'<li><a href="'+d+'" class="'+b.source+'" data-cb-type="'+x+'" data-cb-group="'+a.data("cb-group")+'" data-cb-group-index="'+e+'"'+(l&&""!=l?' data-cb-caption="'+l+'"':"")+(p&&""!=p?' data-cb-hash="'+p+'"':"")+(h&&""!=h?' data-cb-design="'+h+'"':"")+"></a></li>"}o(".cartonbox-nav").html('<ul class="cartonbox-nav-dotted">'+c+"</ul>"),o(".cartonbox-nav").show()}}b.onStartAfter(a),n(a)}function n(a){if(o(".cartonbox-body").data("cb-source")==b.source){e(a),o(".cartonbox-nav-dotted").length&&o(".cartonbox-nav-dotted li").removeClass("active").eq(a.data("cb-group-index")).addClass("active"),o(".cartonbox-content").hide().html(""),i(),b.onLoadBefore(a),o(".cartonbox-preloader").show();var t=a.attr("href"),n=a.data("cb-type"),d=a.data("cb-hash");d&&""!=d?window.history.replaceState(null,null,"#"+d):window.history.replaceState(null,null,"#");var s=a.data("cb-design");s&&""!=s&&o(".cartonbox-wrap").addClass(s),"inline"==n?o(t).length?(o(t).clone(!0).prependTo(".cartonbox-content"),o(".cartonbox-wrap").addClass("cartonbox-inline"),r(a)):(c(a),b.onError(a)):"iframe"==n?/ /.test(t)?(o(".cartonbox-content").load(t,function(){r(a)}),o(".cartonbox-wrap").addClass("cartonbox-inline")):(o(".cartonbox-content").html('<iframe src="'+t+'" frameborder="0"></iframe>'),r(a),o(".cartonbox-wrap").addClass("cartonbox-iframe")):"img"==n&&(o(".cartonbox-content").html('<img src="'+t+'">'),o(".cartonbox-wrap").addClass("cartonbox-img"),r(a))}}function r(a){var t=new Array,n=new Array;o(".cartonbox-container, .cartonbox-container *").each(function(){if("none"!=o(this).css("background-image")){var a=o(this).css("background-image");/url\(/i.test(a)&&(a=a.replace(/^(url\()?\"?\'?/i,""),a=a.replace(/\"?\'?\)?$/i,""),t.push(a))}o(this).is("img")&&t.push(o(this).attr("src")),o(this).is("iframe")&&n.push(o(this))});var r=t.length+n.length;if(r>0){var e=0;if(t.length>0)for(var i=0;i<t.length;i++){var d=new Image;o(d).attr("src",t[i]).on("error",function(){e++,r==e&&c(a),b.onError(a)}).load(function(){e++,r==e&&c(a,d.naturalWidth,d.naturalHeight)})}if(n.length>0)for(var i=0;i<n.length;i++)o(n[i]).load(function(){e++,r==e&&c(a)})}else c(a)}function c(a,t,n){if(b.onLoadAfter(a),b.onShowBefore(a),o(".cartonbox-preloader").hide(),o(".cartonbox-wrap").hasClass("cartonbox-img")){var r=1*o(".cartonbox-flex").css("padding-top").replace(/px/i,"")+1*o(".cartonbox-flex").css("padding-bottom").replace(/px/i,""),c=1*o(".cartonbox-wrap").css("padding-left").replace(/px/i,"")+1*o(".cartonbox-wrap").css("padding-right").replace(/px/i,"");a.data("cb-group")&&""!=a.data("cb-group")&&"dotted"==b.nav&&(r+=o(".cartonbox-nav").innerHeight());var e=n/t;t+c>=o(window).width()?(t=o(window).width()-c,n=t*e,n>o(window).height()-r&&(t=(o(window).height()-r)/e,n=t*e)):n+r>=o(window).height()&&(n=o(window).height()-r,t=n/e,t>o(window).width()-c&&(t=o(window).width()-c)),o(".cartonbox-content img").attr({width:Math.ceil(t),height:Math.ceil(n)}),o(".cartonbox-wrap").css("width",t+c)}var i=a.data("cb-caption");if(i&&""!=i){var d=/^#[\w-]+$/.test(i);d&&o(i).length?(o('<div class="cartonbox-caption"><div class="cartonbox-caption-text"></div></div>').appendTo(".cartonbox-content"),o(i).clone(!0).prependTo(".cartonbox-caption-text")):o('<div class="cartonbox-caption"><div class="cartonbox-caption-text">'+i+"</div></div>").appendTo(".cartonbox-content")}o(".cartonbox-content").show(),o(".cartonbox-container").width("").height(""),o(".cartonbox-wrap:visible").length?(b.onShowNow(a),b.onShowAfter(a)):(o(".cartonbox-wrap, .cartonbox-close").fadeIn(b.speed,function(){b.onShowAfter(a)}),o(".cartonbox-prev a").length&&o(".cartonbox-prev").fadeIn(b.speed),o(".cartonbox-next a").length&&o(".cartonbox-next").fadeIn(b.speed),b.onShowNow(a)),o(".cartonbox-container").width(o(".cartonbox-container").width()).height(o(".cartonbox-container").height()),o(window).scrollTop(0)}function e(a){if(a.data("cb-group")){var t=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"]").not(".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav a").length;if((0!=a.data("cb-group-index")||b.cycle)&&t>1){var n=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"][data-cb-group-index="+(1*a.data("cb-group-index")-1)+"]"),r=1*a.data("cb-group-index")-1;0==a.data("cb-group-index")&&(n=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"][data-cb-group-index="+(t-1)+"]"),r=t-1);var c=n.attr("href"),e=n.data("cb-type"),i=n.data("cb-caption"),d=n.data("cb-hash"),s=n.data("cb-design");o(".cartonbox-prev").html('<a href="'+c+'" class="'+b.source+'" data-cb-type="'+e+'" data-cb-group="'+a.data("cb-group")+'" data-cb-group-index="'+r+'"'+(i&&""!=i?' data-cb-caption="'+i+'"':"")+(d&&""!=d?' data-cb-hash="'+d+'"':"")+(s&&""!=s?' data-cb-design="'+s+'"':"")+'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 55"><polygon points="23.7,54.3 24.6,53.7 1.5,26.5 24.6,1.3 23.7,0.7 0.3,26.5"></polygon></svg></a>'),o(".cartonbox-wrap:visible").length&&o(".cartonbox-prev").show()}else o(".cartonbox-prev").html("").hide();if((a.data("cb-group-index")!=t-1||b.cycle)&&t>1){var x=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"][data-cb-group-index="+(1*a.data("cb-group-index")+1)+"]"),l=1*a.data("cb-group-index")+1;a.data("cb-group-index")==t-1&&(x=o("."+b.source+"[data-cb-group="+a.data("cb-group")+"][data-cb-group-index=0]"),l=0);var p=x.attr("href"),h=x.data("cb-type"),g=x.data("cb-caption"),u=x.data("cb-hash"),v=x.data("cb-design");o(".cartonbox-next").html('<a href="'+p+'" class="'+b.source+'" data-cb-type="'+h+'" data-cb-group="'+a.data("cb-group")+'" data-cb-group-index="'+l+'"'+(g&&""!=g?' data-cb-caption="'+g+'"':"")+(u&&""!=u?' data-cb-hash="'+u+'"':"")+(v&&""!=v?' data-cb-design="'+v+'"':"")+'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 55"><polygon points="1.4,54.3 0.6,53.7 23.1,26.5 0.6,1.3 1.4,0.7 24.3,26.5"></polygon></svg></a>'),o(".cartonbox-wrap:visible").length&&o(".cartonbox-next").show()}else o(".cartonbox-next").html("").hide()}}function i(){o(".cartonbox-wrap").removeAttr("class").addClass("cartonbox-wrap")}function d(){if(b.onClosedBefore(),o(".cartonbox-back, .cartonbox-close, .cartonbox-prev, .cartonbox-next").fadeOut(b.speed),o(".cartonbox-preloader").hide(),o(".cartonbox-body").removeClass("cartonbox-on"),""!=window.location.hash&&window.history.replaceState(null,null,"#"),""!=o(".cartonbox-body").data("cb-existing-hash")){var a=o(".cartonbox-body").data("cb-existing-hash");o("."+b.source+"[data-cb-hash="+a+"]").length||window.history.replaceState(null,null,"#"+o(".cartonbox-body").data("cb-existing-hash"))}o(".cartonbox-wrap").fadeOut(b.speed,function(){o(".cartonbox-nav").hide(),i(),o(".cartonbox-content, .cartonbox-prev, .cartonbox-next, .cartonbox-nav").html(""),o(".cartonbox-wrap, .cartonbox-container").removeAttr("style");var a=1*o(".cartonbox-body").data("cb-top");o(".cartonbox-body").removeData("cb-top").removeData("cb-source").removeData("cb-existing-hash").removeAttr("style"),o(window).scrollTop(a),b.onClosedAfter()})}var b=o.extend({wrap:"body",source:"cartonbox",speed:200,nav:"dotted",cycle:!1,onStartBefore:function(){},onStartAfter:function(){},onLoadBefore:function(){},onLoadAfter:function(){},onShowBefore:function(){},onShowNow:function(){},onShowAfter:function(){},onClosedBefore:function(){},onClosedAfter:function(){},onLeft:function(){},onRight:function(){},onError:function(){alert("Unable to load data!")}},a);o(".cartonbox-body").length||o(b.wrap).wrapInner('<div class="cartonbox-body"></div>'),o(".cartonbox-back").length||o('<div class="cartonbox-back"></div>').insertAfter(".cartonbox-body"),o(".cartonbox-preloader").length||o('<div class="cartonbox-preloader"></div>').insertAfter(".cartonbox-back"),o(".cartonbox-wrap").length||o('<div class="cartonbox-wrap"><div class="cartonbox-flex"><div class="cartonbox-item"><div class="cartonbox-container"><div class="cartonbox-content"></div></div></div><div class="cartonbox-nav"></div></div></div><div class="cartonbox-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25"><polygon points="24.4,1.4 23.6,0.6 12.5,11.8 1.4,0.6 0.6,1.4 11.8,12.5 0.6,23.6 1.4,24.4 12.5,13.2 23.6,24.4 24.4,23.6 13.2,12.5"></polygon></svg></div><div class="cartonbox-prev"></div><div class="cartonbox-next"></div>').insertAfter(".cartonbox-preloader"),o("."+b.source).each(function(){o(this).data("cb-group")&&!o(this).attr("data-cb-group-index")&&o("."+b.source+"[data-cb-group="+o(this).data("cb-group")+"]").each(function(a){o(this).attr("data-cb-group-index",a)})});var s=window.location.hash;""!=s&&"#"!=s&&(s=s.replace("#",""),o("."+b.source+"[data-cb-hash="+s+"]").length&&(o(".cartonbox-body").data("cb-source",b.source),t(o("."+b.source+"[data-cb-hash="+s+"]")))),o("."+b.source).on("click",function(){return o(".cartonbox-body").data("cb-source",b.source),t(o(this)),!1}),o("body").on("click",".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav li:not(.active) a",function(){return o(this).parent().hasClass("cartonbox-prev")&&b.onLeft(o(this)),o(this).parent().hasClass("cartonbox-next")&&b.onRight(o(this)),n(o(this)),!1}),o(".cartonbox-wrap").on("click",".cartonbox-nav .active a",function(){return!1}),o(window).on("keydown",function(a){o(".cartonbox-on").length&&(37==a.which?o(".cartonbox-prev a").length&&(b.onLeft(o(".cartonbox-prev a")),n(o(".cartonbox-prev a"))):39==a.which&&o(".cartonbox-next a").length&&(b.onRight(o(".cartonbox-next a")),n(o(".cartonbox-next a"))))}),o(".cartonbox-back, .cartonbox-preloader, .cartonbox-wrap, .cartonbox-flex, .cartonbox-item, .cartonbox-close, .cartonbox-close svg, .cartonbox-close polygon, .cartonbox-nav").on("click",function(a){a.target==this&&o(".cartonbox-body").data("cb-source")==b.source&&d()}),o(window).on("keydown",function(a){o(".cartonbox-on").length&&27==a.which&&d()})}}(jQuery);
