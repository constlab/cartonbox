/*
 * CartonBox 1.5 by Const Lab, cartonbox.constlab.com
 */
!function(t){"use strict";var o={init:function(o){function a(o){if(!t(".cartonbox-body").data("cb-top")){if(b.onStartBefore(o),t(".cartonbox-body").data("cb-existing-hash")||(d=window.location.hash,d=d.replace("#",""),t(".cartonbox-body").data("cb-existing-hash",d)),!t(".cartonbox-body").data("cb-top")){var a=t(window).scrollTop();t(".cartonbox-body").data("cb-top",a).css({position:"fixed",top:-a,left:0,right:0,bottom:0,overflow:"hidden"})}if(t(".cartonbox-back").fadeIn(b.speed),o.attr("data-cb-group")&&""!=o.attr("data-cb-group")&&"dotted"==b.nav){var r=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"]").not(".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav a").length;if(r>1){for(var c="",e=0;r>e;e++){var i=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"][data-cb-group-index="+e+"]"),x=i.attr("href"),s=i.attr("data-cb-type"),p=i.attr("data-cb-caption"),l=i.attr("data-cb-hash"),h=i.attr("data-cb-design"),g=i.attr("data-cb-options");c=c+'<li><a href="'+x+'" class="cartonbox" data-cb-type="'+s+'" data-cb-group="'+o.attr("data-cb-group")+'" data-cb-group-index="'+e+'"'+(p&&""!=p?' data-cb-caption="'+p+'"':"")+(l&&""!=l?' data-cb-hash="'+l+'"':"")+(h&&""!=h?' data-cb-design="'+h+'"':"")+(g&&""!=g?' data-cb-options="'+g+'"':"")+"></a></li>"}t(".cartonbox-nav").html('<ul class="cartonbox-nav-dotted">'+c+"</ul>"),t(".cartonbox-nav").show()}}b.onStartAfter(o)}n(o)}function n(o){e(o),t(".cartonbox-nav-dotted").length&&t(".cartonbox-nav-dotted li").removeClass("active").eq(o.attr("data-cb-group-index")).addClass("active"),t(".cartonbox-content").hide().html(""),t(".cartonbox-wrap").removeAttr("class data-cb-options").addClass("cartonbox-wrap");var a=o.attr("data-cb-options");a&&""!=a&&t(".cartonbox-wrap").attr("data-cb-options",a),b.onLoadBefore(o),t(".cartonbox-preloader").show();var n=o.attr("href"),i=o.attr("data-cb-type"),d=o.attr("data-cb-hash");d&&""!=d?window.history.replaceState(null,null,"#"+d):window.history.replaceState(null,null," ");var x=o.attr("data-cb-design");x&&""!=x&&t(".cartonbox-wrap").addClass(x),"inline"==i?t(n).length?(t(n).clone(!0).prependTo(".cartonbox-content"),t(".cartonbox-wrap").addClass("cartonbox-inline"),r(o)):(c(o),t.error("Unable to load data!")):"iframe"==i?/ /.test(n)?(t(".cartonbox-content").load(n,function(){r(o)}),t(".cartonbox-wrap").addClass("cartonbox-inline")):(t(".cartonbox-content").html('<iframe src="'+n+'" frameborder="0"></iframe>'),r(o),t(".cartonbox-wrap").addClass("cartonbox-iframe")):"img"==i&&(t(".cartonbox-content").html('<img src="'+n+'">'),t(".cartonbox-wrap").addClass("cartonbox-img"),r(o))}function r(o){var a=new Array,n=new Array;t(".cartonbox-container, .cartonbox-container *").each(function(){if("none"!=t(this).css("background-image")){var o=t(this).css("background-image");/url\(/i.test(o)&&(o=o.replace(/^(url\()?\"?\'?/i,""),o=o.replace(/\"?\'?\)?$/i,""),a.push(o))}t(this).is("img")&&a.push(t(this).attr("src")),t(this).is("iframe")&&n.push(t(this))});var r=a.length+n.length;if(r>0){var e=0;if(a.length>0)for(var i=0;i<a.length;i++){var b=new Image;t(b).attr("src",a[i]).on("error",function(){e++,r==e&&c(o),t.error("Unable to load data!")}).load(function(){e++,r==e&&c(o,b.naturalWidth,b.naturalHeight)})}if(n.length>0)for(var i=0;i<n.length;i++)t(n[i]).load(function(){e++,r==e&&c(o)})}else c(o)}function c(o,a,n){if(b.onLoadAfter(o),b.onShowBefore(o),t(".cartonbox-preloader").hide(),t(".cartonbox-wrap").hasClass("cartonbox-img")){var r=1*t(".cartonbox-flex").css("padding-top").replace(/px/i,"")+1*t(".cartonbox-flex").css("padding-bottom").replace(/px/i,""),c=1*t(".cartonbox-wrap").css("padding-left").replace(/px/i,"")+1*t(".cartonbox-wrap").css("padding-right").replace(/px/i,"");o.attr("data-cb-group")&&""!=o.attr("data-cb-group")&&"dotted"==b.nav&&(r+=t(".cartonbox-nav").innerHeight());var e=n/a;a+c>=t(window).width()?(a=t(window).width()-c,n=a*e,n>t(window).height()-r&&(a=(t(window).height()-r)/e,n=a*e)):n+r>=t(window).height()&&(n=t(window).height()-r,a=n/e,a>t(window).width()-c&&(a=t(window).width()-c)),t(".cartonbox-content img").attr({width:Math.ceil(a),height:Math.ceil(n)}),t(".cartonbox-wrap").css("width",a+c)}else t(".cartonbox-wrap").css("width","");var i=o.attr("data-cb-caption");if(i&&""!=i){var d=/^#[\w-]+$/.test(i);d&&t(i).length?(t('<div class="cartonbox-caption"><div class="cartonbox-caption-text"></div></div>').appendTo(".cartonbox-content"),t(i).clone(!0).prependTo(".cartonbox-caption-text")):t('<div class="cartonbox-caption"><div class="cartonbox-caption-text">'+i+"</div></div>").appendTo(".cartonbox-content")}t(".cartonbox-content").show(),t(".cartonbox-container").width("").height(""),t(".cartonbox-wrap:visible").length?(b.onShowNow(o),b.onShowAfter(o)):(t(".cartonbox-wrap").fadeIn(b.speed,function(){b.onShowAfter(o)}),t(".cartonbox-close").fadeIn(b.speed),t(".cartonbox-prev a").length&&t(".cartonbox-prev").fadeIn(b.speed),t(".cartonbox-next a").length&&t(".cartonbox-next").fadeIn(b.speed),b.onShowNow(o)),t(".cartonbox-container").width(t(".cartonbox-container").width()).height(t(".cartonbox-container").height()),t(window).scrollTop(0)}function e(o){if(o.attr("data-cb-group")){var a=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"]").not(".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav a").length;if((0!=o.attr("data-cb-group-index")||b.cycle)&&a>1){var n=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"][data-cb-group-index="+(1*o.attr("data-cb-group-index")-1)+"]"),r=1*o.attr("data-cb-group-index")-1;0==o.attr("data-cb-group-index")&&(n=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"][data-cb-group-index="+(a-1)+"]"),r=a-1);var c=n.attr("href"),e=n.attr("data-cb-type"),i=n.attr("data-cb-caption"),d=n.attr("data-cb-hash"),x=n.attr("data-cb-design"),s=n.attr("data-cb-options");t(".cartonbox-prev").html('<a href="'+c+'" class="cartonbox" data-cb-type="'+e+'" data-cb-group="'+o.attr("data-cb-group")+'" data-cb-group-index="'+r+'"'+(i&&""!=i?' data-cb-caption="'+i+'"':"")+(d&&""!=d?' data-cb-hash="'+d+'"':"")+(x&&""!=x?' data-cb-design="'+x+'"':"")+(s&&""!=s?' data-cb-options="'+s+'"':"")+'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 55"><polygon points="23.7,54.3 24.6,53.7 1.5,26.5 24.6,1.3 23.7,0.7 0.3,26.5"></polygon></svg></a>'),t(".cartonbox-wrap:visible").length&&t(".cartonbox-prev").show()}else t(".cartonbox-prev").html("").hide();if((o.attr("data-cb-group-index")!=a-1||b.cycle)&&a>1){var p=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"][data-cb-group-index="+(1*o.attr("data-cb-group-index")+1)+"]"),l=1*o.attr("data-cb-group-index")+1;o.attr("data-cb-group-index")==a-1&&(p=t(".cartonbox[data-cb-group="+o.attr("data-cb-group")+"][data-cb-group-index=0]"),l=0);var h=p.attr("href"),g=p.attr("data-cb-type"),u=p.attr("data-cb-caption"),v=p.attr("data-cb-hash"),w=p.attr("data-cb-design"),f=p.attr("data-cb-options");t(".cartonbox-next").html('<a href="'+h+'" class="cartonbox" data-cb-type="'+g+'" data-cb-group="'+o.attr("data-cb-group")+'" data-cb-group-index="'+l+'"'+(u&&""!=u?' data-cb-caption="'+u+'"':"")+(v&&""!=v?' data-cb-hash="'+v+'"':"")+(w&&""!=w?' data-cb-design="'+w+'"':"")+(f&&""!=f?' data-cb-options="'+f+'"':"")+'><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 55"><polygon points="1.4,54.3 0.6,53.7 23.1,26.5 0.6,1.3 1.4,0.7 24.3,26.5"></polygon></svg></a>'),t(".cartonbox-wrap:visible").length&&t(".cartonbox-next").show()}else t(".cartonbox-next").html("").hide()}}function i(){if(b.onClosedBefore(),t(".cartonbox-back, .cartonbox-close, .cartonbox-prev, .cartonbox-next").fadeOut(b.speed),t(".cartonbox-preloader").hide(),""!=window.location.hash&&window.history.replaceState(null,null," "),""!=t(".cartonbox-body").data("cb-existing-hash")){var o=t(".cartonbox-body").data("cb-existing-hash");t(".cartonbox[data-cb-hash="+o+"]").length||window.history.replaceState(null,null,"#"+t(".cartonbox-body").data("cb-existing-hash"))}t(".cartonbox-wrap").fadeOut(b.speed,function(){t(".cartonbox-nav").hide(),t(".cartonbox-wrap").removeAttr("class data-cb-options").addClass("cartonbox-wrap"),t(".cartonbox-content, .cartonbox-prev, .cartonbox-next, .cartonbox-nav").html(""),t(".cartonbox-wrap, .cartonbox-container").removeAttr("style");var o=1*t(".cartonbox-body").data("cb-top");t(".cartonbox-body").removeData("cb-top cb-existing-hash").removeAttr("style"),t(window).scrollTop(o),b.onClosedAfter()})}var b=t.extend({wrap:"body",speed:200,nav:"dotted",cycle:!1,onStartBefore:function(){},onStartAfter:function(){},onLoadBefore:function(){},onLoadAfter:function(){},onShowBefore:function(){},onShowNow:function(){},onShowAfter:function(){},onClosedBefore:function(){},onClosedAfter:function(){},onLeft:function(){},onRight:function(){}},o);t(".cartonbox-body").length||t(b.wrap).wrapInner('<div class="cartonbox-body"></div>'),t(".cartonbox-back").length||t('<div class="cartonbox-back"></div>').insertAfter(".cartonbox-body"),t(".cartonbox-preloader").length||t('<div class="cartonbox-preloader"></div>').insertAfter(".cartonbox-back"),t(".cartonbox-wrap").length||t('<div class="cartonbox-wrap"><div class="cartonbox-flex"><div class="cartonbox-item"><div class="cartonbox-container"><div class="cartonbox-content"></div></div></div><div class="cartonbox-nav"></div></div></div><div class="cartonbox-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25"><polygon points="24.4,1.4 23.6,0.6 12.5,11.8 1.4,0.6 0.6,1.4 11.8,12.5 0.6,23.6 1.4,24.4 12.5,13.2 23.6,24.4 24.4,23.6 13.2,12.5"></polygon></svg></div><div class="cartonbox-prev"></div><div class="cartonbox-next"></div>').insertAfter(".cartonbox-preloader"),t(".cartonbox").each(function(){t(this).attr("data-cb-group")&&!t(this).attr("data-cb-group-index")&&t(".cartonbox[data-cb-group="+t(this).attr("data-cb-group")+"]").each(function(o){t(this).attr("data-cb-group-index",o)})});var d=window.location.hash;""!=d&&"#"!=d&&(d=d.replace("#",""),t(".cartonbox[data-cb-hash="+d+"]").length&&a(t(".cartonbox[data-cb-hash="+d+"]"))),t("body, .cartonbox-back, .cartonbox-preloader, .cartonbox-wrap, .cartonbox-flex, .cartonbox-item, .cartonbox-close, .cartonbox-close svg, .cartonbox-close polygon, .cartonbox-nav").unbind(".onClick"),t(window).unbind(".onClick"),t("body").on("click.onClick",".cartonbox-body .cartonbox, .cartonbox-content .cartonbox",function(){return a(t(this)),!1}),t("body").on("click.onClick",".cartonbox-prev a, .cartonbox-next a, .cartonbox-nav li:not(.active) a",function(){return t(this).parent().hasClass("cartonbox-prev")&&b.onLeft(t(this)),t(this).parent().hasClass("cartonbox-next")&&b.onRight(t(this)),n(t(this)),!1}),t(".cartonbox-wrap").on("click.onClick",".cartonbox-nav .active a",function(){return!1}),t(window).on("keydown.onClick",function(o){t(".cartonbox-body").data("cb-top")&&(37==o.which?t(".cartonbox-prev a").length&&(b.onLeft(t(".cartonbox-prev a")),n(t(".cartonbox-prev a"))):39==o.which&&t(".cartonbox-next a").length&&(b.onRight(t(".cartonbox-next a")),n(t(".cartonbox-next a"))))}),t(".cartonbox-back, .cartonbox-preloader, .cartonbox-wrap, .cartonbox-flex, .cartonbox-item, .cartonbox-close, .cartonbox-close svg, .cartonbox-close polygon, .cartonbox-nav").on("click.onClick",function(t){t.target==this&&i()}),t(window).on("keydown.onClick",function(o){t(".cartonbox-body").data("cb-top")&&27==o.which&&i()})},refresh:function(){t(".cartonbox").removeAttr("data-cb-group-index"),t(".cartonbox").each(function(){t(this).attr("data-cb-group")&&!t(this).attr("data-cb-group-index")&&t(".cartonbox[data-cb-group="+t(this).attr("data-cb-group")+"]").each(function(o){t(this).attr("data-cb-group-index",o)})})},destroy:function(){t(".cartonbox").removeAttr("data-cb-group-index"),t("body").unbind(".onClick"),t(window).unbind(".onClick"),t(".cartonbox-body").children().unwrap(),t(".cartonbox-back, .cartonbox-preloader, .cartonbox-wrap, .cartonbox-close, .cartonbox-prev, .cartonbox-next").remove()}};t.cartonbox=function(a){return o[a]?o[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error("Method "+a+" not found!"):o.init.apply(this,arguments)}}(jQuery);
